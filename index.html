<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>d3: Topojson Basemap</title>
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
<script type="text/javascript" src="js/d3.v3.min.js"></script>
<script type="text/javascript" src="js/queue.v1.min.js"></script>
<script type="text/javascript" src="js/topojson.js"></script>

<!--[if IE]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
</head>


<body>
<div id="wrap">
	<div id="map"></div>
</div>
<script>
function init() {
	setMap();
}

function setMap() {
	var width = 1200,
		height = 560;

	var svg = d3.select("#map").append("svg")
		.attr("width", width)
		.attr("height", height);

	

	var projection = d3.geo.mercator()
		.scale(200)
		.translate([width / 2, height / 2])
		.center([0,20]);

	var path = d3.geo.path()
		.projection(projection);

	//loads in different data files before running the map process
	queue()
		.defer(d3.json, "data/world.json")
		.defer(d3.json, "data/stadiums.json")
		.await(ready);
	
	//run this after files are loaded
	function ready(error, world, stadia) {

		svg.append("path")
			.datum(topojson.feature(world, world.objects.land))
			.attr("class", "land")
			.attr("d", path);

		length = stadia.features.length;
		console.log(length);
		var min = Infinity, max = -Infinity;
		for (var mug=0; mug<length; mug++) {
			var capacity = stadia.features[mug].properties.capacity
			if ( capacity < min) {
				min = capacity;
				console.log(min);
			}
			if ( capacity > max) {
				max = capacity;
			}
		}
		console.log(min, max);

		var radius = d3.scale.sqrt()
			.domain([30012, 223000])
			.range([0, 20]);

		svg.selectAll(".stadium")
			.data(stadia.features.sort(function(b) { return b.properties.capacity; }))
			.enter().append("path")
				.attr("class", "stadium")
				.attr("d", path.pointRadius(function(d) { return radius(d.properties.capacity); }))
				.on("mouseover", mouseOn)
				.on("mouseout", mouseOff);
	}

	function mouseOn() {
		d3.select(this)
			.attr("class", "stadOn");
	}
	function mouseOff() {
		d3.select(this)
			.attr("class", "stadOff");
	}
}

window.onload = init();
</script>
</body>
</html>